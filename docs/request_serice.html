<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Request Services - L'Adore Travel</title>
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="description" content="Customer Information Form - L'Adore Travel"/>
</head>
<body class="bg-gray-50 text-gray-800">

  <!-- Header (re-using site style) -->
  <header class="bg-white shadow">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
      <a href="index.html" class="text-xl font-bold text-blue-800">L'Adore Travel</a>
      <nav>
        <ul class="flex space-x-6">
          <li><a href="index.html" class="hover:text-blue-600">Home</a></li>
          <li><a href="europe.html" class="hover:text-blue-600">Europe</a></li>
          <li><a href="request_services.html" class="text-blue-600 font-semibold">Request Services</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Main -->
  <main class="container mx-auto px-4 py-10">
    <h1 class="text-3xl font-bold text-center mb-8">Customer Information Form</h1>

    <!-- Status banner -->
    <div id="statusBanner" class="hidden mb-6 p-4 rounded-lg"></div>

    <form id="travelForm" class="space-y-10">

      <!-- PRIMARY TRAVELER -->
      <section class="bg-white p-6 rounded-xl shadow">
        <h2 class="text-2xl font-semibold mb-4">Primary Traveler</h2>
        <div class="grid md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm">Full Legal Name</label>
            <input type="text" name="primary_full_name" required class="w-full border rounded p-2">
          </div>
          <div>
            <label class="block text-sm">Preferred First Name</label>
            <input type="text" name="primary_preferred_name" class="w-full border rounded p-2">
          </div>
          <div class="md:col-span-2">
            <label class="block text-sm">Address</label>
            <input type="text" name="primary_address" class="w-full border rounded p-2">
          </div>
          <div>
            <label class="block text-sm">Phone</label>
            <input type="tel" name="primary_phone" class="w-full border rounded p-2">
          </div>
          <div>
            <label class="block text-sm">Email <span class="text-red-600">*</span></label>
            <input type="email" name="primary_email" required class="w-full border rounded p-2">
          </div>
          <div>
            <label class="block text-sm">Date of Birth</label>
            <input type="date" name="primary_dob" class="w-full border rounded p-2">
          </div>
          <div>
            <label class="block text-sm">Preferred Origin Airport</label>
            <input type="text" name="primary_origin_airport" class="w-full border rounded p-2" placeholder="e.g., DFW, IAH">
          </div>
          <div class="md:col-span-2">
            <label class="block text-sm">Preferred Airlines (comma separated)</label>
            <input type="text" name="primary_preferred_airlines" class="w-full border rounded p-2" placeholder="e.g., Delta, United">
          </div>
        </div>

        <!-- AIRLINE FF -->
        <h3 class="text-lg font-semibold mt-6 mb-2">Airline Frequent Flyer Numbers</h3>
        <p class="text-sm text-gray-600 mb-2">Check any that apply and include your account number.</p>
        <div class="grid md:grid-cols-2 gap-2" id="airlinePrograms">
          <label class="flex items-center gap-2">
            <input type="checkbox" name="ff_american_checked">
            <span>American / oneworld</span>
            <input type="text" name="ff_american_number" class="border rounded p-1 ml-auto w-48" placeholder="Acct #">
          </label>
          <label class="flex items-center gap-2">
            <input type="checkbox" name="ff_delta_checked">
            <span>Delta / SkyTeam</span>
            <input type="text" name="ff_delta_number" class="border rounded p-1 ml-auto w-48" placeholder="Acct #">
          </label>
          <label class="flex items-center gap-2">
            <input type="checkbox" name="ff_united_checked">
            <span>United / Star Alliance</span>
            <input type="text" name="ff_united_number" class="border rounded p-1 ml-auto w-48" placeholder="Acct #">
          </label>
          <label class="flex items-center gap-2">
            <input type="checkbox" name="ff_southwest_checked">
            <span>Southwest</span>
            <input type="text" name="ff_southwest_number" class="border rounded p-1 ml-auto w-48" placeholder="Acct #">
          </label>
          <label class="flex items-center gap-2">
            <input type="checkbox" name="ff_jetblue_checked">
            <span>JetBlue</span>
            <input type="text" name="ff_jetblue_number" class="border rounded p-1 ml-auto w-48" placeholder="Acct #">
          </label>
        </div>
        <!-- Dynamic "Other" Airlines -->
        <div id="airlineOthers" class="mt-3 space-y-2"></div>
        <button type="button" id="addAirlineOther" class="mt-2 text-sm px-3 py-1 border rounded hover:bg-gray-100">+ Add another airline program</button>

        <!-- HOTEL LOYALTY -->
        <h3 class="text-lg font-semibold mt-8 mb-2">Hotel Loyalty Program Numbers</h3>
        <p class="text-sm text-gray-600 mb-2">Check any that apply and include your account number.</p>
        <div class="grid md:grid-cols-2 gap-2" id="hotelPrograms">
          <label class="flex items-center gap-2">
            <input type="checkbox" name="hotel_marriott_checked">
            <span>Marriott Bonvoy</span>
            <input type="text" name="hotel_marriott_number" class="border rounded p-1 ml-auto w-48" placeholder="Acct #">
          </label>
          <label class="flex items-center gap-2">
            <input type="checkbox" name="hotel_hilton_checked">
            <span>Hilton Honors</span>
            <input type="text" name="hotel_hilton_number" class="border rounded p-1 ml-auto w-48" placeholder="Acct #">
          </label>
          <label class="flex items-center gap-2">
            <input type="checkbox" name="hotel_hyatt_checked">
            <span>World of Hyatt</span>
            <input type="text" name="hotel_hyatt_number" class="border rounded p-1 ml-auto w-48" placeholder="Acct #">
          </label>
          <label class="flex items-center gap-2">
            <input type="checkbox" name="hotel_wyndham_checked">
            <span>Wyndham Rewards</span>
            <input type="text" name="hotel_wyndham_number" class="border rounded p-1 ml-auto w-48" placeholder="Acct #">
          </label>
        </div>
        <!-- Dynamic "Other" Hotels -->
        <div id="hotelOthers" class="mt-3 space-y-2"></div>
        <button type="button" id="addHotelOther" class="mt-2 text-sm px-3 py-1 border rounded hover:bg-gray-100">+ Add another hotel program</button>

        <!-- CAR RENTAL REWARDS -->
        <h3 class="text-lg font-semibold mt-8 mb-2">Car Rental Rewards</h3>
        <p class="text-sm text-gray-600 mb-2">Check any that apply and include your account number.</p>
        <div class="grid md:grid-cols-2 gap-2" id="carPrograms">
          <label class="flex items-center gap-2">
            <input type="checkbox" name="car_hertz_checked">
            <span>Hertz Gold</span>
            <input type="text" name="car_hertz_number" class="border rounded p-1 ml-auto w-48" placeholder="Acct #">
          </label>
          <label class="flex items-center gap-2">
            <input type="checkbox" name="car_avis_checked">
            <span>Avis Preferred</span>
            <input type="text" name="car_avis_number" class="border rounded p-1 ml-auto w-48" placeholder="Acct #">
          </label>
          <label class="flex items-center gap-2">
            <input type="checkbox" name="car_enterprise_checked">
            <span>Enterprise Plus</span>
            <input type="text" name="car_enterprise_number" class="border rounded p-1 ml-auto w-48" placeholder="Acct #">
          </label>
          <label class="flex items-center gap-2">
            <input type="checkbox" name="car_national_checked">
            <span>National Emerald Club</span>
            <input type="text" name="car_national_number" class="border rounded p-1 ml-auto w-48" placeholder="Acct #">
          </label>
        </div>
        <!-- Dynamic "Other" Cars -->
        <div id="carOthers" class="mt-3 space-y-2"></div>
        <button type="button" id="addCarOther" class="mt-2 text-sm px-3 py-1 border rounded hover:bg-gray-100">+ Add another car program</button>

        <!-- PASSPORT -->
        <h3 class="text-lg font-semibold mt-8 mb-2">Passport & Security</h3>
        <div class="grid md:grid-cols-3 gap-4">
          <div>
            <label class="block text-sm">Passport Number</label>
            <input type="text" name="passport_number" class="w-full border rounded p-2">
          </div>
          <div>
            <label class="block text-sm">Nationality</label>
            <input type="text" name="passport_nationality" class="w-full border rounded p-2" placeholder="e.g., USA">
          </div>
          <div>
            <label class="block text-sm">Issuance Date</label>
            <input type="date" name="passport_issue" class="w-full border rounded p-2">
          </div>
          <div>
            <label class="block text-sm">Expiration Date</label>
            <input type="date" name="passport_expiration" class="w-full border rounded p-2">
          </div>
          <div>
            <label class="block text-sm">Known Traveler Number (KTN)</label>
            <input type="text" name="known_traveler_number" class="w-full border rounded p-2">
          </div>
          <div>
            <label class="block text-sm">Redress Number</label>
            <input type="text" name="redress_number" class="w-full border rounded p-2">
          </div>
        </div>
      </section>

      <!-- SECONDARY TRAVELERS (dynamic) -->
      <section id="secondaryTravelers" class="space-y-6"></section>

      <div class="flex gap-3">
        <button type="button" id="addTraveler" class="bg-blue-600 text-white px-4 py-2 rounded">Add Another Traveler</button>
        <button type="button" id="saveDraft" class="bg-gray-700 text-white px-4 py-2 rounded">Save Draft</button>
        <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded">Submit</button>
      </div>

      <p class="text-xs text-gray-500">Submitting will send an email to our static address (To:) and CC the email you provide above. Your form entries will remain visible on this page after submission.</p>
    </form>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-800 text-white py-6 mt-12">
    <div class="container mx-auto px-4 text-center">
      <p>&copy; 2025 L'Adore Travel Consultants, LLC</p>
    </div>
  </footer>

  <script>
    // --- Helpers to build dynamic "Other" rows ---
    function buildOtherRow(prefix, index) {
      const wrapper = document.createElement('div');
      wrapper.className = 'flex items-center gap-2';
      wrapper.innerHTML = `
        <input type="text" name="${prefix}_other_label_${index}" class="border rounded p-2 flex-1" placeholder="Program name (e.g., Alaska Mileage Plan)">
        <input type="text" name="${prefix}_other_number_${index}" class="border rounded p-2 w-48" placeholder="Acct #">
        <button type="button" class="text-sm px-3 py-1 border rounded hover:bg-red-50 removeOther">Remove</button>
      `;
      return wrapper;
    }

    function attachAddOther(buttonId, containerId, prefix) {
      const btn = document.getElementById(buttonId);
      const container = document.getElementById(containerId);
      btn.addEventListener('click', () => {
        const idx = container.children.length + 1;
        const row = buildOtherRow(prefix, idx);
        container.appendChild(row);
        row.querySelector('.removeOther').addEventListener('click', () => row.remove());
      });
    }

    attachAddOther('addAirlineOther', 'airlineOthers', 'airline');
    attachAddOther('addHotelOther', 'hotelOthers', 'hotel');
    attachAddOther('addCarOther', 'carOthers', 'car');

    // --- Secondary Traveler template ---
    function buildSecondaryTraveler(index) {
      const div = document.createElement('div');
      div.className = 'bg-white p-6 rounded-xl shadow secondary-traveler';
      div.dataset.index = index;
      div.innerHTML = `
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-2xl font-semibold">Secondary Traveler ${index}</h2>
          <button type="button" class="text-sm px-3 py-1 border rounded hover:bg-red-50 removeTraveler">Remove</button>
        </div>
        <div class="grid md:grid-cols-2 gap-4">
          <div><label class="block text-sm">Full Legal Name</label><input type="text" name="secondary_${index}_full_name" class="w-full border rounded p-2"></div>
          <div><label class="block text-sm">Preferred First Name</label><input type="text" name="secondary_${index}_preferred_name" class="w-full border rounded p-2"></div>
          <div><label class="block text-sm">Phone</label><input type="tel" name="secondary_${index}_phone" class="w-full border rounded p-2"></div>
          <div><label class="block text-sm">Email</label><input type="email" name="secondary_${index}_email" class="w-full border rounded p-2"></div>
          <div><label class="block text-sm">Date of Birth</label><input type="date" name="secondary_${index}_dob" class="w-full border rounded p-2"></div>
        </div>

        <h3 class="text-lg font-semibold mt-6 mb-2">Passport & Security</h3>
        <div class="grid md:grid-cols-3 gap-4">
          <div><label class="block text-sm">Passport Number</label><input type="text" name="secondary_${index}_passport_number" class="w-full border rounded p-2"></div>
          <div><label class="block text-sm">Nationality</label><input type="text" name="secondary_${index}_passport_nationality" class="w-full border rounded p-2"></div>
          <div><label class="block text-sm">Issuance Date</label><input type="date" name="secondary_${index}_passport_issue" class="w-full border rounded p-2"></div>
          <div><label class="block text-sm">Expiration Date</label><input type="date" name="secondary_${index}_passport_expiration" class="w-full border rounded p-2"></div>
          <div><label class="block text-sm">Known Traveler Number (KTN)</label><input type="text" name="secondary_${index}_ktn" class="w-full border rounded p-2"></div>
          <div><label class="block text-sm">Redress Number</label><input type="text" name="secondary_${index}_redress" class="w-full border rounded p-2"></div>
        </div>

        <div class="mt-4">
          <label class="block text-sm mb-1">Frequent Flyer / Hotel / Car Programs (optional)</label>
          <textarea name="secondary_${index}_loyalty_notes" class="w-full border rounded p-2" rows="3" placeholder="If applicable, list program name(s) and account number(s)."></textarea>
        </div>
      `;
      return div;
    }

    const secondaryContainer = document.getElementById('secondaryTravelers');
    document.getElementById('addTraveler').addEventListener('click', () => {
      const idx = secondaryContainer.querySelectorAll('.secondary-traveler').length + 1;
      const block = buildSecondaryTraveler(idx);
      secondaryContainer.appendChild(block);
      block.querySelector('.removeTraveler').addEventListener('click', () => block.remove());
    });

    // --- Serialize form into a structured JSON payload ---
    function collectPrograms(sectionPrefix) {
      const list = [];
      const mapping = {
        airline: [
          ['ff_american_checked','ff_american_number','American / oneworld'],
          ['ff_delta_checked','ff_delta_number','Delta / SkyTeam'],
          ['ff_united_checked','ff_united_number','United / Star Alliance'],
          ['ff_southwest_checked','ff_southwest_number','Southwest'],
          ['ff_jetblue_checked','ff_jetblue_number','JetBlue']
        ],
        hotel: [
          ['hotel_marriott_checked','hotel_marriott_number','Marriott Bonvoy'],
          ['hotel_hilton_checked','hotel_hilton_number','Hilton Honors'],
          ['hotel_hyatt_checked','hotel_hyatt_number','World of Hyatt'],
          ['hotel_wyndham_checked','hotel_wyndham_number','Wyndham Rewards']
        ],
        car: [
          ['car_hertz_checked','car_hertz_number','Hertz Gold'],
          ['car_avis_checked','car_avis_number','Avis Preferred'],
          ['car_enterprise_checked','car_enterprise_number','Enterprise Plus'],
          ['car_national_checked','car_national_number','National Emerald Club']
        ]
      };

      // Standard checked programs
      (mapping[sectionPrefix] || []).forEach(([checkedName, numName, label]) => {
        const checked = document.querySelector(`[name="${checkedName}"]`);
        const num = document.querySelector(`[name="${numName}"]`);
        if ((checked && checked.checked) || (num && num.value.trim() !== '')) {
          list.push({ program: label, number: num ? num.value.trim() : '' });
        }
      });

      // Dynamic Others
      const othersContainer = document.getElementById(sectionPrefix + 'Others');
      if (othersContainer) {
        [...othersContainer.children].forEach(row => {
          const [labelEl, numEl] = row.querySelectorAll('input');
          const program = (labelEl?.value || '').trim();
          const number = (numEl?.value || '').trim();
          if (program || number) list.push({ program, number });
        });
      }
      return list;
    }

    function collectPrimary() {
      const get = name => (document.querySelector(`[name="${name}"]`)?.value || '').trim();
      return {
        full_name: get('primary_full_name'),
        preferred_name: get('primary_preferred_name'),
        address: get('primary_address'),
        phone: get('primary_phone'),
        email: get('primary_email'),
        dob: get('primary_dob'),
        origin_airport: get('primary_origin_airport'),
        preferred_airlines: get('primary_preferred_airlines'),
        passport: {
          number: get('passport_number'),
          nationality: get('passport_nationality'),
          issue: get('passport_issue'),
          expiration: get('passport_expiration'),
          ktn: get('known_traveler_number'),
          redress: get('redress_number')
        },
        programs: {
          airlines: collectPrograms('airline'),
          hotels: collectPrograms('hotel'),
          cars: collectPrograms('car')
        }
      };
    }

    function collectSecondaries() {
      const result = [];
      const blocks = document.querySelectorAll('.secondary-traveler');
      blocks.forEach(block => {
        const idx = block.dataset.index;
        const get = n => (block.querySelector(`[name="secondary_${idx}_${n}"]`)?.value || '').trim();
        result.push({
          full_name: get('full_name'),
          preferred_name: get('preferred_name'),
          phone: get('phone'),
          email: get('email'),
          dob: get('dob'),
          passport: {
            number: get('passport_number'),
            nationality: get('passport_nationality'),
            issue: get('passport_issue'),
            expiration: get('passport_expiration'),
            ktn: get('ktn'),
            redress: get('redress')
          },
          loyalty_notes: get('loyalty_notes')
        });
      });
      return result;
    }

    function buildPayload() {
      const payload = {
        primary: collectPrimary(),
        secondary: collectSecondaries(),
        metadata: {
          submitted_at: new Date().toISOString(),
          page: 'request_services'
        }
      };
      return payload;
    }

    // --- Save/Load Draft (localStorage) ---
    const DRAFT_KEY = 'ladore_travel_request_services_draft_v1';

    function saveDraft() {
      const payload = buildPayload();
      localStorage.setItem(DRAFT_KEY, JSON.stringify(payload));
      showBanner('Draft saved locally on this device.', 'success');
    }

    function loadDraft() {
      const raw = localStorage.getItem(DRAFT_KEY);
      if (!raw) return;
      try {
        const draft = JSON.parse(raw);
        // Primary
        const p = draft.primary || {};
        const set = (name, val) => { const el = document.querySelector(`[name="${name}"]`); if (el) el.value = val || ''; };
        set('primary_full_name', p.full_name);
        set('primary_preferred_name', p.preferred_name);
        set('primary_address', p.address);
        set('primary_phone', p.phone);
        set('primary_email', p.email);
        set('primary_dob', p.dob);
        set('primary_origin_airport', p.origin_airport);
        set('primary_preferred_airlines', p.preferred_airlines);

        // Passport primary
        if (p.passport) {
          set('passport_number', p.passport.number);
          set('passport_nationality', p.passport.nationality);
          set('passport_issue', p.passport.issue);
          set('passport_expiration', p.passport.expiration);
          set('known_traveler_number', p.passport.ktn);
          set('redress_number', p.passport.redress);
        }

        // Programs primary (standard checkboxes)
        const programRestores = (prefix, mapping, items=[]) => {
          const map = new Map((items || []).map(i => [i.program, i.number]));
          mapping.forEach(([checkedName, numName, label]) => {
            const numEl = document.querySelector(`[name="${numName}"]`);
            const chkEl = document.querySelector(`[name="${checkedName}"]`);
            if (map.has(label)) {
              if (numEl) numEl.value = map.get(label) || '';
              if (chkEl) chkEl.checked = true;
            }
          });
        };
        const airlineMap = [
          ['ff_american_checked','ff_american_number','American / oneworld'],
          ['ff_delta_checked','ff_delta_number','Delta / SkyTeam'],
          ['ff_united_checked','ff_united_number','United / Star Alliance'],
          ['ff_southwest_checked','ff_southwest_number','Southwest'],
          ['ff_jetblue_checked','ff_jetblue_number','JetBlue']
        ];
        const hotelMap = [
          ['hotel_marriott_checked','hotel_marriott_number','Marriott Bonvoy'],
          ['hotel_hilton_checked','hotel_hilton_number','Hilton Honors'],
          ['hotel_hyatt_checked','hotel_hyatt_number','World of Hyatt'],
          ['hotel_wyndham_checked','hotel_wyndham_number','Wyndham Rewards']
        ];
        const carMap = [
          ['car_hertz_checked','car_hertz_number','Hertz Gold'],
          ['car_avis_checked','car_avis_number','Avis Preferred'],
          ['car_enterprise_checked','car_enterprise_number','Enterprise Plus'],
          ['car_national_checked','car_national_number','National Emerald Club']
        ];
        const programs = (p.programs || {});
        programRestores('airline', airlineMap, programs.airlines || []);
        programRestores('hotel', hotelMap, programs.hotels || []);
        programRestores('car', carMap, programs.cars || []);

        // Restore dynamic "Other" for each section
        function restoreOthers(containerId, prefix, items, knownLabels) {
          const others = (items || []).filter(i => !knownLabels.includes(i.program));
          others.forEach((i, idx) => {
            const container = document.getElementById(containerId);
            const row = buildOtherRow(prefix, idx + 1);
            container.appendChild(row);
            const [labelEl, numEl] = row.querySelectorAll('input');
            if (labelEl) labelEl.value = i.program || '';
            if (numEl) numEl.value = i.number || '';
            row.querySelector('.removeOther').addEventListener('click', () => row.remove());
          });
        }
        restoreOthers('airlineOthers','airline', programs.airlines, airlineMap.map(m => m[2]));
        restoreOthers('hotelOthers','hotel', programs.hotels, hotelMap.map(m => m[2]));
        restoreOthers('carOthers','car', programs.cars, carMap.map(m => m[2]));

        // Secondary
        (draft.secondary || []).forEach((s, i) => {
          const idx = secondaryContainer.querySelectorAll('.secondary-traveler').length + 1;
          const block = buildSecondaryTraveler(idx);
          secondaryContainer.appendChild(block);
          const getName = n => block.querySelector(`[name="secondary_${idx}_${n}"]`);
          if (getName('full_name')) getName('full_name').value = s.full_name || '';
          if (getName('preferred_name')) getName('preferred_name').value = s.preferred_name || '';
          if (getName('phone')) getName('phone').value = s.phone || '';
          if (getName('email')) getName('email').value = s.email || '';
          if (getName('dob')) getName('dob').value = s.dob || '';
          if (s.passport) {
            if (getName('passport_number')) getName('passport_number').value = s.passport.number || '';
            if (getName('passport_nationality')) getName('passport_nationality').value = s.passport.nationality || '';
            if (getName('passport_issue')) getName('passport_issue').value = s.passport.issue || '';
            if (getName('passport_expiration')) getName('passport_expiration').value = s.passport.expiration || '';
            if (getName('ktn')) getName('ktn').value = s.passport.ktn || '';
            if (getName('redress')) getName('redress').value = s.passport.redress || '';
          }
          if (getName('loyalty_notes')) getName('loyalty_notes').value = s.loyalty_notes || '';
          block.querySelector('.removeTraveler').addEventListener('click', () => block.remove());
        });

        showBanner('A saved draft was loaded from this device.', 'info');
      } catch (e) {
        console.warn('Failed to load draft', e);
      }
    }

    // --- Banner helper ---
    function showBanner(message, type='info') {
      const el = document.getElementById('statusBanner');
      el.textContent = message;
      el.classList.remove('hidden', 'bg-green-50', 'text-green-700', 'bg-blue-50', 'text-blue-700', 'bg-red-50', 'text-red-700');
      if (type === 'success') { el.classList.add('bg-green-50','text-green-700'); }
      else if (type === 'info') { el.classList.add('bg-blue-50','text-blue-700'); }
      else { el.classList.add('bg-red-50','text-red-700'); }
    }

    // --- Submit handler ---
    document.getElementById('travelForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      // Basic required check for primary email (also has required attr)
      const emailEl = document.querySelector('[name="primary_email"]');
      if (!emailEl || !emailEl.value.trim()) {
        showBanner('Please provide a valid email address for the primary traveler.', 'error');
        emailEl && emailEl.focus();
        return;
      }

      const payload = buildPayload();

      try {
        // Replace with your deployed Google Apps Script Web App URL in Stage 2
        const endpoint = 'https://script.google.com/macros/s/AKfycbyawd-ghcVSY-XHuGCdoa6xZ-xTVqMgyoflEwGjRAKEaKybo-IrQ2k0zSNU4MtACPVg/exec';
        const res = await fetch(endpoint, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        if (res.ok) {
          showBanner('Form submitted successfully! A confirmation email will be sent (To: static address, CC: traveler). Your entries are still visible below.', 'success');
          // Intentionally NOT clearing the form (per your requirement)
        } else {
          const txt = await res.text();
          showBanner('There was a problem submitting your form. ' + (txt || ''), 'error');
        }
      } catch (err) {
        showBanner('Network error while submitting form: ' + err.message, 'error');
      }
    });

    // Event bindings
    document.getElementById('saveDraft').addEventListener('click', saveDraft);
    window.addEventListener('load', loadDraft);
  </script>
</body>
</html>
